定义： 001 和 011 为两种不同的角块，其按顺时针的磁极为 0, 0, 1 和 0, 1, 1。

# 搜索四个 001 和四个 011 角块的可复原构型和复原状态

定义**构型**为：拼装时的角块orientation和permutation的组合。对于弹块/二阶魔方而言，仅取决于某一个角块的orientation状态。
故对弹块魔方而言，构型总数为3。

定义**复原状态**为：所有接触面上的磁铁对的磁极都是相反的，即表面都是平的。

## 结论

经过搜索，三种构型均有复原状态，均可复原。且复原态均不相同。
 
## 各个构型的复原状态

| 构型 | 复原状态 |
| --- | --- |
|当前奇艺构型| 17个|
|奇艺构型+一个角块逆时针旋转|17个|
|奇艺构型+一个角块顺时针旋转|41个|


定义一个角块的**主方向**（类似于二阶魔方中R/D的方向）为，该面的颜色与其他两面不同。

如果固定魔方，则将主方向视为角块中RD面的颜色，同时规定从R/D面开始计数相邻的三个面为0, 1, 2。
则正常二阶魔方所有角块的计数和模3为0，对应奇艺构型+一个角块顺时针旋转。

这使得可以通过角块计数和的模来定义构型。（这里没找文献，自己给个名字吧，纯民科）不妨定位为构型数。

| 构型 | 复原状态 | 构型数 |
| --- | --- | --- |
|当前奇艺构型| 17个| 2 |
|奇艺构型+一个角块逆时针旋转|17个| 1 |
|奇艺构型+一个角块顺时针旋转|41个| 0 |



# 从平凹状态恢复状态

由上一节可知，实际上可能是一个平凹状态对应多个状态。

## 搜索不确定性的来源

1. DBL块的不确定，有6种可能
2. 不同状态对应同样的平凹状态


定义：磁极对为两个相接触的磁铁，定义其磁极方向为位于ULF面磁极的方向。

显然可知，只要确定ULF面的磁极，根据平凹方向，可以确定整体魔方的磁极方向。而且可以保证0/1的数量是相等的。


所以在实际代码实现中，使用的是磁极对+平凹状态来确定一个状态，然后通过角块构型和整体构型来筛选。


首先需要满足四个 001 和四个 011 角块，然后计算构型数，最后通过构型数来筛选。

这里并未去除不可能的构型，只是将优先级调低。


# 通过恢复的状态尝试复原

尽管不能一次搜索就复原，但是可以通过交互式的方法，让用户遍历所有的可能解法。

即：
```
possible_states = SEARCH()
prev_solution = []
for possible_state in possible_states:
    possible_state.apply(prev_solution)
    possible_solution = SOLVE(possible_state)
    prev_solution.append(possible_solution)
    
    solved = input("Is it solved? (y/n, default n)")
    if solved == "y":
        break
```

possible_states为通过平凹状态搜索得到的所有可能状态。

可是使用recon.py来尝试这一方法。